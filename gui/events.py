# gui/events.py
# ============================================================================
# –§–ê–ô–õ –û–ë–†–ê–ë–û–¢–ö–ò –°–û–ë–´–¢–ò–ô –ò –õ–û–ì–ò–ö–ò –†–ê–ë–û–¢–´ –ü–†–û–ì–†–ê–ú–ú–´
# ============================================================================
# –≠—Ç–æ—Ç —Ñ–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å—é –ª–æ–≥–∏–∫—É —Ä–∞–±–æ—Ç—ã GUI-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:
# - –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –Ω–∞–∂–∞—Ç–∏–π –Ω–∞ –∫–Ω–æ–ø–∫–∏
# - –§—É–Ω–∫—Ü–∏–∏ –∑–∞–≥—Ä—É–∑–∫–∏ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ñ–∞–π–ª–æ–≤
# - –ê–ª–≥–æ—Ä–∏—Ç–º—ã –≤—Å—Ç—Ä–∞–∏–≤–∞–Ω–∏—è –∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –≤–æ–¥—è–Ω—ã—Ö –∑–Ω–∞–∫–æ–≤
# - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–æ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
# - –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ –≤—ã–≤–æ–¥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
#
# –û—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–∏–Ω—Ü–∏–ø: –∫–∞–∂–¥–∞—è –∫–Ω–æ–ø–∫–∞ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ —Å–≤—è–∑–∞–Ω–∞ —Å —Ñ—É–Ω–∫—Ü–∏–µ–π –≤ —ç—Ç–æ–º —Ñ–∞–π–ª–µ
# —á–µ—Ä–µ–∑ –º–µ—Ö–∞–Ω–∏–∑–º —Å–∏–≥–Ω–∞–ª–æ–≤ –∏ —Å–ª–æ—Ç–æ–≤ PyQt5 (connect_events)
# ============================================================================

from PyQt5.QtWidgets import QFileDialog, QMessageBox
from PyQt5.QtCore import Qt
from PyQt5.QtGui import QPixmap
from PIL import Image      # –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏
import numpy as np         # –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –º–∞—Å—Å–∏–≤–∞–º–∏ (–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–∞–∫ –º–∞—Å—Å–∏–≤—ã –ø–∏–∫—Å–µ–ª–µ–π)
import os                  # –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–æ–π
from watermark.embedding import embed      # –ù–∞—à–∏ —Ñ—É–Ω–∫—Ü–∏–∏ –≤—Å—Ç—Ä–∞–∏–≤–∞–Ω–∏—è –≤–æ–¥—è–Ω—ã—Ö –∑–Ω–∞–∫–æ–≤
from watermark.extraction import extract   # –ù–∞—à–∏ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –≤–æ–¥—è–Ω—ã—Ö –∑–Ω–∞–∫–æ–≤

def connect_events(parent):
    """
    ========================================================================
    –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–ï –û–ë–†–ê–ë–û–¢–ß–ò–ö–û–í –°–û–ë–´–¢–ò–ô
    ========================================================================
    –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è —Å–≤—è–∑—ã–≤–∞–µ—Ç –∫–Ω–æ–ø–∫–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ —Å —Ñ—É–Ω–∫—Ü–∏—è–º–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏.
    –ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç –∫–Ω–æ–ø–∫—É, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è
    —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∞—è —Ñ—É–Ω–∫—Ü–∏—è.
    
    –ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã PyQt5:
    - widget.clicked.connect(function) - —Å–≤—è–∑—ã–≤–∞–µ—Ç –Ω–∞–∂–∞—Ç–∏–µ —Å —Ñ—É–Ω–∫—Ü–∏–µ–π
    - lambda - –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–µ—Ä–µ–¥–∞—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∞—Ä–≥—É–º–µ–Ω—Ç—ã –≤ —Ñ—É–Ω–∫—Ü–∏—é
    ========================================================================
    """
    # –°–≤—è–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫–∏ —Å —Ñ—É–Ω–∫—Ü–∏—è–º–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏:
    parent.btn_load_cover.clicked.connect(lambda: load_cover_file(parent))
    parent.btn_load_wm.clicked.connect(lambda: load_wm_file(parent))
    parent.btn_embed.clicked.connect(lambda: embed_watermark(parent))
    parent.btn_extract.clicked.connect(lambda: extract_watermark(parent))
    parent.btn_save_result.clicked.connect(lambda: save_stego_result(parent))
    parent.btn_save_secret.clicked.connect(lambda: save_extracted_secret(parent))
    parent.btn_reset.clicked.connect(lambda: reset_gui(parent))

    # –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –ø–æ –ø—Ä–µ–≤—å—é —Å–µ–∫—Ä–µ—Ç–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
    parent.secret_image_label.mousePressEvent = lambda event: on_secret_preview_clicked(parent, event)
    # –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –ø–æ –ø—Ä–µ–≤—å—é –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–æ–≥–æ —Å–µ–∫—Ä–µ—Ç–∞
    parent.restored_image_label.mousePressEvent = lambda event: on_restored_secret_preview_clicked(parent, event)
import tempfile
def on_restored_secret_preview_clicked(parent, event):
    """
    –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –ø–æ QLabel –ø—Ä–µ–≤—å—é –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–æ–≥–æ —Å–µ–∫—Ä–µ—Ç–∞.
    –ï—Å–ª–∏ —Å–µ–∫—Ä–µ—Ç ‚Äî —Ç–µ–∫—Å—Ç, —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –µ–≥–æ –≤–æ –≤—Ä–µ–º–µ–Ω–Ω—ã–π txt-—Ñ–∞–π–ª –∏ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç.
    """
    secret = getattr(parent, "extracted_secret", None)
    secret_type = getattr(parent, "embedded_secret_type", None)
    if secret_type == "text" and secret:
        try:
            with tempfile.NamedTemporaryFile(delete=False, suffix=".txt", mode="w", encoding="utf-8") as tmp:
                tmp.write(secret)
                tmp_path = tmp.name
            import sys
            if sys.platform.startswith('win'):
                os.startfile(tmp_path)
            elif sys.platform.startswith('darwin'):
                import subprocess
                subprocess.call(['open', tmp_path])
            else:
                import subprocess
                subprocess.call(['xdg-open', tmp_path])
        except Exception as e:
            QMessageBox.warning(parent, "–û—à–∏–±–∫–∞", f"–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–∫—Ä—ã—Ç—å —Ñ–∞–π–ª: {e}")

def on_secret_preview_clicked(parent, event):
    """
    –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –ø–æ QLabel –ø—Ä–µ–≤—å—é —Å–µ–∫—Ä–µ—Ç–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è.
    –ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω —Å–µ–∫—Ä–µ—Ç —Ç–∏–ø–∞ —Ç–µ–∫—Å—Ç, –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∑–∞–≥–ª—É—à–∫—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, QMessageBox).
    """
    import subprocess
    import sys
    secret_type = getattr(parent, "secret_type", None)
    wm_path = getattr(parent, "wm_path", None)
    if secret_type == "text" and wm_path:
        try:
            if sys.platform.startswith('win'):
                os.startfile(wm_path)
            elif sys.platform.startswith('darwin'):
                subprocess.call(['open', wm_path])
            else:
                subprocess.call(['xdg-open', wm_path])
        except Exception as e:
            QMessageBox.warning(parent, "–û—à–∏–±–∫–∞", f"–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–∫—Ä—ã—Ç—å —Ñ–∞–π–ª: {e}")

def on_text_input_changed(parent, text):
    """
    ========================================================================
    –û–ë–†–ê–ë–û–¢–ß–ò–ö –ò–ó–ú–ï–ù–ï–ù–ò–Ø –¢–ï–ö–°–¢–ê –í –ü–û–õ–ï –í–í–û–î–ê –°–ï–ö–†–ï–¢–ê
    ========================================================================
    –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∫–∞–∂–¥—ã–π —Ä–∞–∑, –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–∑–º–µ–Ω—è–µ—Ç —Ç–µ–∫—Å—Ç
    –≤ –ø–æ–ª–µ –≤–≤–æ–¥–∞ —Å–µ–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è.
    
    –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã:
    - –ï—Å–ª–∏ —Ç–µ–∫—Å—Ç –≤–≤–µ–¥–µ–Ω ‚Üí –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä "–¢–µ–∫—Å—Ç –≤–≤–µ–¥–µ–Ω"
    - –ï—Å–ª–∏ —Ç–µ–∫—Å—Ç –æ—á–∏—â–µ–Ω ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ "–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ"
    - –ü—Ä–∏ –≤–≤–æ–¥–µ —Ç–µ–∫—Å—Ç–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—á–∏—â–∞–µ—Ç—Å—è –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É –≤–æ–¥—è–Ω–æ–≥–æ –∑–Ω–∞–∫–∞
    ========================================================================
    """
    if text.strip():  # –ï—Å–ª–∏ –≤–≤–µ–¥–µ–Ω —Ç–µ–∫—Å—Ç (–Ω–µ –ø—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞)
        # –û—á–∏—â–∞–µ–º –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —Å–µ–∫—Ä–µ—Ç–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —Ç–µ–∫—Å—Ç–∞
        parent.secret_image_label.clear()
        parent.secret_image_label.setText("üí¨ –¢–µ–∫—Å—Ç –≤–≤–µ–¥–µ–Ω")
        parent.secret_image_label.setStyleSheet("border: 2px solid #FF9800; color: #FF9800;")  # –û—Ä–∞–Ω–∂–µ–≤–∞—è —Ä–∞–º–∫–∞ –¥–ª—è –≤–≤–µ–¥–µ–Ω–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞
        
        # –û—á–∏—â–∞–µ–º –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É –≤–æ–¥—è–Ω–æ–≥–æ –∑–Ω–∞–∫–∞, –µ—Å–ª–∏ –µ—Å—Ç—å
        if hasattr(parent, 'wm_path'):
            delattr(parent, 'wm_path')
    else:
        # –ï—Å–ª–∏ —Ç–µ–∫—Å—Ç –æ—á–∏—â–µ–Ω, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∏—Å—Ö–æ–¥–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
        parent.secret_image_label.setText("–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ")
        parent.secret_image_label.setStyleSheet("border: 2px dashed #aaa; color: #666;")

def load_and_display_image(image_path, label_widget, max_size=(250, 200)):
    """
    ========================================================================
    –ó–ê–ì–†–£–ó–ö–ê –ò –û–¢–û–ë–†–ê–ñ–ï–ù–ò–ï –ò–ó–û–ë–†–ê–ñ–ï–ù–ò–Ø –í –û–ö–ù–ï –ü–†–ï–î–ü–†–û–°–ú–û–¢–†–ê
    ========================================================================
    –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∂–∞–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–∑ —Ñ–∞–π–ª–∞ –∏ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –µ–≥–æ –≤ —É–∫–∞–∑–∞–Ω–Ω–æ–º
    –≤–∏–¥–∂–µ—Ç–µ QLabel —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ–º.
    
    –ê—Ä–≥—É–º–µ–Ω—Ç—ã:
    - image_path: –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
    - label_widget: –≤–∏–¥–∂–µ—Ç QLabel –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
    - max_size: –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä (—à–∏—Ä–∏–Ω–∞, –≤—ã—Å–æ—Ç–∞) –≤ –ø–∏–∫—Å–µ–ª—è—Ö
    
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:
    - True: –µ—Å–ª–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ
    - False: –µ—Å–ª–∏ –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞
    
    –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:
    - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ RGB —Ñ–æ—Ä–º–∞—Ç
    - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø—Ä–æ–ø–æ—Ä—Ü–∏–∏ –ø—Ä–∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–∏
    - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –≤—ã—Å–æ–∫–æ–∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º LANCZOS
    ========================================================================
    """
    try:
        # –ó–∞–≥—Ä—É–∂–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å –ø–æ–º–æ—â—å—é –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ PIL
        pil_image = Image.open(image_path)
        # –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ RGB –µ—Å–ª–∏ –Ω—É–∂–Ω–æ (–¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)
        if pil_image.mode != 'RGB':
            pil_image = pil_image.convert('RGB')
        # –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º PIL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ QPixmap –¥–ª—è PyQt5
        import io
        img_buffer = io.BytesIO()
        pil_image.save(img_buffer, format='PNG')
        img_buffer.seek(0)
        pixmap = QPixmap()
        pixmap.loadFromData(img_buffer.getvalue())
        label_widget.setPixmap(pixmap)
        label_widget.setStyleSheet("border: 2px solid #4CAF50;")  # –ó–µ–ª–µ–Ω–∞—è —Ä–∞–º–∫–∞ –¥–ª—è –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
        return True
    except Exception as e:
        print(f"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è: {e}")
        return False

def load_cover_file(parent):
    """
    ========================================================================
    –ó–ê–ì–†–£–ó–ö–ê –ò–°–•–û–î–ù–û–ì–û –ò–ó–û–ë–†–ê–ñ–ï–ù–ò–Ø (–ö–û–ù–¢–ï–ô–ù–ï–†–ê)
    ========================================================================
    –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –∫–Ω–æ–ø–∫–∏ "–ó–∞–≥—Ä—É–∑–∏—Ç—å –∏—Å—Ö–æ–¥–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ".
    –û—Ç–∫—Ä—ã–≤–∞–µ—Ç –¥–∏–∞–ª–æ–≥ –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞ –∏ –∑–∞–≥—Ä—É–∂–∞–µ—Ç –≤—ã–±—Ä–∞–Ω–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ.
    
    –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:
    1. –û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –¥–∏–∞–ª–æ–≥ –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞ —Å —Ñ–∏–ª—å—Ç—Ä–æ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
    2. –í—ã–±—Ä–∞–Ω–Ω—ã–π –ø—É—Ç—å —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ parent.cover_path
    3. –ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
    4. –í—ã–≤–æ–¥–∏—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ –æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –≤ –æ–±–ª–∞—Å—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
    ========================================================================
    """
    fname, _ = QFileDialog.getOpenFileName(parent, "–í—ã–±–µ—Ä–∏—Ç–µ –∏—Å—Ö–æ–¥–Ω—ã–π —Ñ–∞–π–ª", "", "Images (*.png *.jpg *.bmp *.jpeg);;All Files (*)")
    if fname:  # –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±—Ä–∞–ª —Ñ–∞–π–ª (–Ω–µ –Ω–∞–∂–∞–ª "–û—Ç–º–µ–Ω–∞")
        parent.cover_path = fname  # –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É
        parent.result_text.append(f"–ó–∞–≥—Ä—É–∂–µ–Ω –∏—Å—Ö–æ–¥–Ω—ã–π —Ñ–∞–π–ª: {fname}")
        
        # –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
        if load_and_display_image(fname, parent.cover_image_label):
            parent.result_text.append("‚úÖ –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω")
        else:
            parent.result_text.append("‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è")

def load_wm_file(parent):
    """
    ========================================================================
    –ó–ê–ì–†–£–ó–ö–ê –§–ê–ô–õ–ê –í–û–î–Ø–ù–û–ì–û –ó–ù–ê–ö–ê (–°–ï–ö–†–ï–¢–ù–´–• –î–ê–ù–ù–´–•)
    ========================================================================
    –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –∫–Ω–æ–ø–∫–∏ "–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª –≤–æ–¥—è–Ω–æ–≥–æ –∑–Ω–∞–∫–∞".
    –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –¥–≤–∞ —Ç–∏–ø–∞ —Ñ–∞–π–ª–æ–≤:
    - –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (PNG, JPG, BMP) - –¥–ª—è –≤—Å—Ç—Ä–∞–∏–≤–∞–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
    - –¢–µ–∫—Å—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã (TXT) - –¥–ª—è –≤—Å—Ç—Ä–∞–∏–≤–∞–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ –∏–∑ —Ñ–∞–π–ª–∞
    
    –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã:
    1. –û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –¥–∏–∞–ª–æ–≥ –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞
    2. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—á–∏—â–∞–µ—Ç—Å—è –ø–æ–ª–µ –≤–≤–æ–¥–∞ —Ç–µ–∫—Å—Ç–∞ (–∏—Å–∫–ª—é—á–∞–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç)
    3. –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è —Ç–∏–ø —Ñ–∞–π–ª–∞ –ø–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—é
    4. –î–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π - –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä
    5. –î–ª—è —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤ - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Å–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –∏–∫–æ–Ω–∫–∞
    ========================================================================
    """
    fname, _ = QFileDialog.getOpenFileName(parent, "–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª –≤–æ–¥—è–Ω–æ–≥–æ –∑–Ω–∞–∫–∞", "", "Images (*.png *.jpg *.bmp);;Text files (*.txt);;All Files (*)")
    if fname:
        parent.wm_path = fname
        parent.result_text.append(f"–ó–∞–≥—Ä—É–∂–µ–Ω —Ñ–∞–π–ª –≤–æ–¥—è–Ω–æ–≥–æ –∑–Ω–∞–∫–∞: {fname}")
        ext = os.path.splitext(fname)[1].lower()
        if ext in [".jpg", ".jpeg", ".png", ".bmp"]:
            if load_and_display_image(fname, parent.secret_image_label):
                parent.result_text.append("‚úÖ –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —Å–µ–∫—Ä–µ—Ç–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω")
            else:
                parent.result_text.append("‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —Å–µ–∫—Ä–µ—Ç–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è")
            parent.secret_type = "image"
        elif ext == ".txt":
            parent.secret_image_label.clear()
            parent.secret_image_label.setText("üìÑ –¢–µ–∫—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª –¥–ª—è –≤—Å—Ç—Ä–∞–∏–≤–∞–Ω–∏—è")
            parent.secret_image_label.setStyleSheet("border: 2px solid #2196F3; color: #2196F3;")
            parent.secret_type = "text"
            parent.result_text.append("üìÑ –ó–∞–≥—Ä—É–∂–µ–Ω —Ç–µ–∫—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª")
        else:
            parent.secret_image_label.clear()
            parent.secret_image_label.setText("‚ùì –ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç")
            parent.secret_image_label.setStyleSheet("border: 2px dashed #aaa; color: #666;")
            parent.secret_type = None

def embed_watermark(parent):
    """
    ========================================================================
    –í–°–¢–†–ê–ò–í–ê–ù–ò–ï –í–û–î–Ø–ù–û–ì–û –ó–ù–ê–ö–ê –í –ò–ó–û–ë–†–ê–ñ–ï–ù–ò–ï
    ========================================================================
    –ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≥—Ä–∞–º–º—ã! –í—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç —Å–µ–∫—Ä–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
    —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –∞–ª–≥–æ—Ä–∏—Ç–º–∞ —Å—Ç–µ–≥–∞–Ω–æ–≥—Ä–∞—Ñ–∏–∏.
    
    –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ç–∏–ø—ã —Å–µ–∫—Ä–µ—Ç–æ–≤:
    - –¢–µ–∫—Å—Ç (–≤–≤–µ–¥–µ–Ω–Ω—ã–π –≤ –ø–æ–ª–µ –∏–ª–∏ –∏–∑ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ —Ñ–∞–π–ª–∞)
    - –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (–∏–∑ —Ñ–∞–π–ª–∞ PNG/JPG/BMP)
    
    –≠—Ç–∞–ø—ã —Ä–∞–±–æ—Ç—ã:
    1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (–µ—Å—Ç—å –ª–∏ –∏—Å—Ö–æ–¥–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏ —Å–µ–∫—Ä–µ—Ç)
    2. –ó–∞–≥—Ä—É–∑–∫–∞ –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö
    3. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ —Å–µ–∫—Ä–µ—Ç–∞ –∏ –µ–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
    4. –í—ã–∑–æ–≤ –∞–ª–≥–æ—Ä–∏—Ç–º–∞ –≤—Å—Ç—Ä–∞–∏–≤–∞–Ω–∏—è
    5. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –≤ —Ñ–∞–π–ª
    6. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –º–µ—Ç–∞–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–≥–æ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è
    ========================================================================
    """
    # ========================================================================
    # –≠–¢–ê–ü 1: –ü–û–õ–£–ß–ï–ù–ò–ï –ò –ü–†–û–í–ï–†–ö–ê –í–•–û–î–ù–´–• –î–ê–ù–ù–´–•
    # ========================================================================
    
    cover_path = getattr(parent, "cover_path", None)
    wm_path = getattr(parent, "wm_path", None)
    secret_type = getattr(parent, "secret_type", None)
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –≤—ã–±—Ä–∞–Ω–æ –ª–∏ –∏—Å—Ö–æ–¥–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
    if not cover_path:
        QMessageBox.warning(parent, "–û—à–∏–±–∫–∞", "–ù–µ –≤—ã–±—Ä–∞–Ω –∏—Å—Ö–æ–¥–Ω—ã–π —Ñ–∞–π–ª.")
        return
    if not wm_path or not secret_type:
        QMessageBox.warning(parent, "–û—à–∏–±–∫–∞", "–ù–µ –≤—ã–±—Ä–∞–Ω –≤–æ–¥—è–Ω–æ–π –∑–Ω–∞–∫ (—Ñ–∞–π–ª –∏–ª–∏ —Ç–µ–∫—Å—Ç).")
        return
    try:
        # ====================================================================
        # –≠–¢–ê–ü 2: –ó–ê–ì–†–£–ó–ö–ê –ò –ü–û–î–ì–û–¢–û–í–ö–ê –î–ê–ù–ù–´–•
        # ====================================================================
        
        # –ó–∞–≥—Ä—É–∂–∞–µ–º –∏—Å—Ö–æ–¥–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–∞–∫ –º–∞—Å—Å–∏–≤ –ø–∏–∫—Å–µ–ª–µ–π
        cover = np.array(Image.open(cover_path))
        
        # –ü–æ–ª—É—á–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∞–ª–≥–æ—Ä–∏—Ç–º–∞ –∏–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
        depth = parent.spinbox_depth.value()  # –ì–ª—É–±–∏–Ω–∞ –≤—Å—Ç—Ä–∞–∏–≤–∞–Ω–∏—è (1-8 –±–∏—Ç)
        params = {"depth": depth}

        # ====================================================================
        # –≠–¢–ê–ü 3: –û–ü–†–ï–î–ï–õ–ï–ù–ò–ï –¢–ò–ü–ê –°–ï–ö–†–ï–¢–ê –ò –ï–ì–û –û–ë–†–ê–ë–û–¢–ö–ê
        # ====================================================================
        
        if secret_type == "text":
            with open(wm_path, 'r', encoding='utf-8') as f:
                secret = f.read()
            parent.embedded_secret_type = "text"
            parent.embedded_secret_length = len(secret.encode("utf-8"))
            parent.embedded_depth = depth
        elif secret_type == "image":
            secret = np.array(Image.open(wm_path))
            parent.embedded_secret_type = "image"
            parent.embedded_secret_shape = secret.shape
            parent.embedded_depth = depth

        # ====================================================================
        # –≠–¢–ê–ü 4: –í–°–¢–†–ê–ò–í–ê–ù–ò–ï –°–ï–ö–†–ï–¢–ê –í –ò–ó–û–ë–†–ê–ñ–ï–ù–ò–ï
        # ====================================================================
        
        # –í—ã–∑—ã–≤–∞–µ–º –∞–ª–≥–æ—Ä–∏—Ç–º –≤—Å—Ç—Ä–∞–∏–≤–∞–Ω–∏—è (–∏–∑ –º–æ–¥—É–ª—è watermark.embedding)
        result = embed(cover, secret, params, method="lsb")
        
        # ====================================================================
        # –≠–¢–ê–ü 5: –°–û–•–†–ê–ù–ï–ù–ò–ï –†–ï–ó–£–õ–¨–¢–ê–¢–ê
        # ====================================================================
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Ç–µ–≥–æ-–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤–æ –≤—Ä–µ–º–µ–Ω–Ω—ã–π –ø—É—Ç—å, –Ω–æ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
        parent.stego_result = result
        parent.result_text.append(f"‚úÖ –í—Å—Ç—Ä–∞–∏–≤–∞–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ! –†–µ–∑—É–ª—å—Ç–∞—Ç –≥–æ—Ç–æ–≤ –¥–ª—è –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è.")
        parent.btn_save_result.setEnabled(True)
        # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–µ–≤—å—é —Å—Ç–µ–≥–æ–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (–≤—Å–µ–≥–¥–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ)
        img = Image.fromarray(result)
        import io
        buf = io.BytesIO()
        img.save(buf, format='PNG')
        buf.seek(0)
        pixmap = QPixmap()
        pixmap.loadFromData(buf.getvalue())
        parent.stego_image_label.setPixmap(pixmap)
        parent.stego_image_label.setStyleSheet("border: 2px solid #4CAF50;")
        
    except Exception as exc:
        # –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞, –Ω–µ—Ö–≤–∞—Ç–∫–∞ –º–µ—Å—Ç–∞ –∏ —Ç.–¥.)
        parent.result_text.append(f"‚ùå –û—à–∏–±–∫–∞ –≤—Å—Ç—Ä–∞–∏–≤–∞–Ω–∏—è: {exc}")
        

def extract_watermark(parent):
    """
    ========================================================================
    –ò–ó–í–õ–ï–ß–ï–ù–ò–ï –í–û–î–Ø–ù–û–ì–û –ó–ù–ê–ö–ê –ò–ó –°–¢–ï–ì–û-–ò–ó–û–ë–†–ê–ñ–ï–ù–ò–Ø
    ========================================================================
    –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –∏–∑–≤–ª–µ–∫–∞–µ—Ç —Å–µ–∫—Ä–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ —Å—Ç–µ–≥–æ-–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, —Å–æ–∑–¥–∞–Ω–Ω–æ–≥–æ
    —Ñ—É–Ω–∫—Ü–∏–µ–π embed_watermark().
    
    –í–∞–∂–Ω–æ: –¥–ª—è —É—Å–ø–µ—à–Ω–æ–≥–æ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –Ω—É–∂–Ω–∞ –º–µ—Ç–∞–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–æ–º, —á—Ç–æ –±—ã–ª–æ
    –≤—Å—Ç—Ä–æ–µ–Ω–æ (—Ç–∏–ø —Å–µ–∫—Ä–µ—Ç–∞, —Ä–∞–∑–º–µ—Ä, –≥–ª—É–±–∏–Ω–∞). –≠—Ç–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è
    –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –≤—Å—Ç—Ä–∞–∏–≤–∞–Ω–∏–∏.
    
    –≠—Ç–∞–ø—ã —Ä–∞–±–æ—Ç—ã:
    1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è —Å—Ç–µ–≥–æ-–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏ –º–µ—Ç–∞–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
    2. –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–µ–≥–æ-–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
    3. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è
    4. –í—ã–∑–æ–≤ –∞–ª–≥–æ—Ä–∏—Ç–º–∞ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è
    5. –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–ª–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
    ========================================================================
    """
    # ========================================================================
    # –≠–¢–ê–ü 1: –ü–û–õ–£–ß–ï–ù–ò–ï –ò –ü–†–û–í–ï–†–ö–ê –î–ê–ù–ù–´–• –î–õ–Ø –ò–ó–í–õ–ï–ß–ï–ù–ò–Ø
    # ========================================================================
    
    # –ò—â–µ–º —Ñ–∞–π–ª –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è: —Å–Ω–∞—á–∞–ª–∞ stego_result.png, –ø–æ—Ç–æ–º –∏—Å—Ö–æ–¥–Ω—ã–π —Ñ–∞–π–ª
    stego_result = getattr(parent, "stego_result", None)
    secret_type = getattr(parent, "embedded_secret_type", None)
    if stego_result is None or not secret_type:
        QMessageBox.warning(parent, "–û—à–∏–±–∫–∞", "–ù–µ—Ç —Å—Ç–µ–≥–æ-—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è.")
        return
    try:
        # ====================================================================
        # –≠–¢–ê–ü 2: –ó–ê–ì–†–£–ó–ö–ê –°–¢–ï–ì–û-–ò–ó–û–ë–†–ê–ñ–ï–ù–ò–Ø
        # ====================================================================
        stego_image = stego_result
        # ====================================================================
        # –≠–¢–ê–ü 3: –ü–û–î–ì–û–¢–û–í–ö–ê –ü–ê–†–ê–ú–ï–¢–†–û–í –î–õ–Ø –ò–ó–í–õ–ï–ß–ï–ù–ò–Ø
        # ====================================================================
        depth = getattr(parent, "embedded_depth", parent.spinbox_depth.value())
        params = {"depth": depth}
        if secret_type == "text":
            params["length"] = getattr(parent, "embedded_secret_length", 10)
        elif secret_type == "image":
            params["secret_shape"] = getattr(parent, "embedded_secret_shape", (64, 64, 3))
        # ====================================================================
        # –≠–¢–ê–ü 4: –ò–ó–í–õ–ï–ß–ï–ù–ò–ï –°–ï–ö–†–ï–¢–ù–´–• –î–ê–ù–ù–´–•
        # ====================================================================
        extracted = extract(stego_image, params, method="lsb")
        # ====================================================================
        # –≠–¢–ê–ü 5: –û–¢–û–ë–†–ê–ñ–ï–ù–ò–ï –†–ï–ó–£–õ–¨–¢–ê–¢–ê
        # ====================================================================
        if isinstance(extracted, str):
            parent.extracted_secret = extracted
            parent.result_text.append(f"üîç –ò–∑–≤–ª–µ—á—ë–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç –≥–æ—Ç–æ–≤ –¥–ª—è –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è.")
            parent.restored_image_label.clear()
            parent.restored_image_label.setText("üìÑ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç")
            parent.restored_image_label.setStyleSheet("border: 2px solid #2196F3; color: #2196F3;")
        else:
            parent.extracted_secret = extracted
            parent.result_text.append(f"üîç –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≥–æ—Ç–æ–≤ –¥–ª—è –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è.")
            img = Image.fromarray(extracted)
            import io
            buf = io.BytesIO()
            img.save(buf, format='PNG')
            buf.seek(0)
            pixmap = QPixmap()
            pixmap.loadFromData(buf.getvalue())
            parent.restored_image_label.setPixmap(pixmap)
            parent.restored_image_label.setStyleSheet("border: 2px solid #4CAF50;")
        parent.btn_save_secret.setEnabled(True)
    except Exception as exc:
        parent.result_text.append(f"‚ùå –û—à–∏–±–∫–∞ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è: {exc}")

def reset_gui(parent):
    """
    ========================================================================
    –°–ë–†–û–° –ò–ù–¢–ï–†–§–ï–ô–°–ê –ö –ò–°–•–û–î–ù–û–ú–£ –°–û–°–¢–û–Ø–ù–ò–Æ
    ========================================================================
    –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –∫–Ω–æ–ø–∫–∏ "–°–±—Ä–æ—Å–∏—Ç—å" –∏ –æ—á–∏—â–∞–µ—Ç –≤—Å–µ
    –ø–æ–ª—è, –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã.
    
    –ß—Ç–æ –æ—á–∏—â–∞–µ—Ç—Å—è:
    - –ü–æ–ª–µ –≤–≤–æ–¥–∞ —Ç–µ–∫—Å—Ç–∞ –≤–æ–¥—è–Ω–æ–≥–æ –∑–Ω–∞–∫–∞
    - –û–±–ª–∞—Å—Ç—å –≤—ã–≤–æ–¥–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
    - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≥–ª—É–±–∏–Ω—ã –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –∫ 1 –±–∏—Ç—É
    - –û–∫–Ω–∞ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
    - –í—Å–µ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ –ø—É—Ç–∏ –∫ —Ñ–∞–π–ª–∞–º –∏ –º–µ—Ç–∞–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
    
    –≠—Ç–æ –ø–æ–ª–µ–∑–Ω–æ –¥–ª—è –Ω–∞—á–∞–ª–∞ –Ω–æ–≤–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏ "—Å —á–∏—Å—Ç–æ–≥–æ –ª–∏—Å—Ç–∞".
    ========================================================================
    """
    # ====================================================================
    # –û–ß–ò–°–¢–ö–ê –ü–û–õ–ï–ô –í–í–û–î–ê –ò –ù–ê–°–¢–†–û–ï–ö
    # ====================================================================
    
    parent.result_text.clear()
    parent.spinbox_depth.setValue(1)
    parent.cover_image_label.clear()
    parent.cover_image_label.setText("–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ")
    parent.cover_image_label.setStyleSheet("border: 2px dashed #aaa; color: #666;")
    parent.secret_image_label.clear()
    parent.secret_image_label.setText("–§–∞–π–ª –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω")
    parent.secret_image_label.setStyleSheet("border: 2px dashed #aaa; color: #666;")
    parent.stego_image_label.clear()
    parent.stego_image_label.setText("–ù–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞")
    parent.stego_image_label.setStyleSheet("border: 2px dashed #aaa; color: #666;")
    parent.restored_image_label.clear()
    parent.restored_image_label.setText("–ù–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞")
    parent.restored_image_label.setStyleSheet("border: 2px dashed #aaa; color: #666;")
    parent.btn_save_result.setEnabled(False)
    parent.btn_save_secret.setEnabled(False)
    attributes_to_clear = [
        'cover_path', 'wm_path', 'stego_result', 'embedded_secret_type', 'embedded_secret_length', 'embedded_secret_shape', 'embedded_depth', 'secret_type', 'extracted_secret'
    ]
    for attr in attributes_to_clear:
        if hasattr(parent, attr):
            delattr(parent, attr)

# ========== –ù–æ–≤—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫: —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å—Ç–µ–≥–æ-—Ä–µ–∑—É–ª—å—Ç–∞—Ç ==========
def save_stego_result(parent):
    result = getattr(parent, 'stego_result', None)
    if result is None:
        QMessageBox.warning(parent, "–û—à–∏–±–∫–∞", "–ù–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è.")
        return
    fname, _ = QFileDialog.getSaveFileName(parent, "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å—Ç–µ–≥–æ-–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ", "stego_result.png", "Images (*.png *.jpg *.bmp)")
    if fname:
        Image.fromarray(result).save(fname)
        parent.result_text.append(f"üíæ –°—Ç–µ–≥–æ-–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ: {fname}")

# ========== –ù–æ–≤—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫: —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π —Å–µ–∫—Ä–µ—Ç ==========
def save_extracted_secret(parent):
    secret = getattr(parent, 'extracted_secret', None)
    secret_type = getattr(parent, 'embedded_secret_type', None)
    if secret is None or secret_type is None:
        QMessageBox.warning(parent, "–û—à–∏–±–∫–∞", "–ù–µ—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–æ–≥–æ —Å–µ–∫—Ä–µ—Ç–∞ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è.")
        return
    if secret_type == "image":
        fname, _ = QFileDialog.getSaveFileName(parent, "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ", "extracted_secret.png", "Images (*.png *.jpg *.bmp)")
        if fname:
            Image.fromarray(secret).save(fname)
            parent.result_text.append(f"üíæ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ: {fname}")
    elif secret_type == "text":
        fname, _ = QFileDialog.getSaveFileName(parent, "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç", "extracted_secret.txt", "Text files (*.txt)")
        if fname:
            with open(fname, 'w', encoding='utf-8') as f:
                f.write(secret)
            parent.result_text.append(f"üíæ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω: {fname}")
